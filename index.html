<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Analyzer — Este Essaouira Sports Club</title>
<style>
  :root{
    --blue:#0b63a7;
    --orange:#ff7a2d;
    --bg:#1c1c1c;
    --text:#1d5d96;
    --muted:#f6f7f9;
    font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;
  }
  body{margin:0;background:var(--bg);color:var(--text);padding:18px}
  .container{max-width:980px;margin:0 auto;display:grid;gap:18px}
  h1{margin:0 0 6px;font-size:20px;color:var(--blue)}
  p.lead{margin:0;color:#375b7a}
  .card{background:var(--card-bg);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,18,42,0.04)}
  form.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  label{display:block;font-weight:600;margin-bottom:6px;color:#174a6f}
  input, select{width:100%;padding:10px;border-radius:8px;border:1px solid #cfdff0;background:white;font-size:14px}
  .full{grid-column:1/-1}
  button.primary{background:var(--blue);color:white;padding:12px 16px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
  .results{display:flex;gap:12px;flex-wrap:wrap}
  .metric{flex:1 1 140px;padding:12px;border-radius:10px;background:white;text-align:center;box-shadow:0 4px 12px rgba(2,18,42,0.04)}
  .metric h3{margin:0;color:var(--blue)} .metric p{margin:6px 0 0;color:#375b7a}
  .ai-output{white-space:pre-wrap;background:white;padding:12px;border-radius:10px;min-height:120px}
  @media(max-width:720px){form.grid{grid-template-columns:1fr}}
  .small{font-size:13px;color:#7b98b0}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Analyseur Physique</h1>
    <p class="lead">Entrez vos informations et obtenez un score, une estimation de la composition corporelle et des conseils personnalisés.</p>
  </header>

  <section class="card" aria-labelledby="form-title">
    <h2 id="form-title">Données utilisateur</h2>
    <form id="analyzeForm" class="grid" onsubmit="event.preventDefault(); computeAndAnalyze();">
      <div>
        <label>Sexe</label>
        <select id="sex">
          <option value="male">Homme</option>
          <option value="female">Femme</option>
        </select>
      </div>

      <div>
        <label>Âge</label>
        <input id="age" type="number" min="10" max="120" value="25">
      </div>

      <div>
        <label>Taille (cm)</label>
        <input id="height" type="number" min="50" max="250" value="175">
      </div>

      <div>
        <label>Poids (kg)</label>
        <input id="weight" type="number" min="20" max="400" value="75">
      </div>

      <!-- Optional circumference fields for Navy formula -->
      <div>
        <label>Tour de taille (cm) — optionnel</label>
        <input id="waist" type="number" min="40" max="200" placeholder="ex: 80">
      </div>
      <div>
        <label>Tour de cou (cm) — optionnel</label>
        <input id="neck" type="number" min="25" max="80" placeholder="ex: 38">
      </div>
      <div>
        <label>Tour de hanches (cm) — femmes seulement (optionnel)</label>
        <input id="hip" type="number" min="40" max="200" placeholder="ex: 100">
      </div>

      <div class="full">
        <label>Niveau d'activité</label>
        <select id="activity">
          <option value="sedentary">Sédentaire</option>
          <option value="light">Légère (1–3 jours/semaine)</option>
          <option value="moderate">Modérée (3–5 jours/semaine)</option>
          <option value="high">Active (6–7 jours)</option>
        </select>
      </div>

      <div class="full">
        <button type="submit" class="primary">Calculer & Obtenir Analyse IA</button>
        <p class="small">L'IA produit une interprétation et des recommandations. Vos données doivent être traitées côté serveur pour appeler l'API IA en toute sécurité.</p>
      </div>
    </form>
  </section>

  <section class="card">
    <h2>Résultats rapides</h2>
    <div class="results" id="quickResults">
      <div class="metric"><h3 id="bmi">—</h3><p>BMI</p></div>
      <div class="metric"><h3 id="bodyfat">—</h3><p>Est. % masse grasse</p></div>
      <div class="metric"><h3 id="muscle">—</h3><p>Muscle proxy</p></div>
    </div>
  </section>

  <section class="card">
    <h2>Analyse IA</h2>
    <div id="aiStatus" class="small">Prêt.</div>
    <div class="ai-output" id="aiOutput">Appuyez sur « Calculer & Obtenir Analyse IA » pour générer un rapport détaillé (texte produit par une IA sur serveur).</div>
  </section>
</div>

<script>
/*
  Client-side calculators:
  - BMI
  - Simple US Navy body fat estimate
  - Basic "muscle proxy" (heuristic)
  Then sends data to backend /api/analyze which should:
    - call your chosen AI (recommended: GPT-5 Thinking mini or GPT-4 family)
    - return a friendly analysis string (JSON { analysis: "..." })
  IMPORTANT: Never call LLM API directly from browser with secret key.
*/

function computeAndAnalyze(){
  const sex = document.getElementById('sex').value;
  const age = Number(document.getElementById('age').value);
  const heightCm = Number(document.getElementById('height').value);
  const weightKg = Number(document.getElementById('weight').value);
  const waist = Number(document.getElementById('waist').value) || null;
  const neck = Number(document.getElementById('neck').value) || null;
  const hip = Number(document.getElementById('hip').value) || null;
  const activity = document.getElementById('activity').value;

  // --- BMI
  const heightM = heightCm/100;
  const bmi = weightKg / (heightM*heightM);
  document.getElementById('bmi').innerText = bmi.toFixed(1);

  // --- Body fat estimate (US Navy method) (simple)
  let bodyFatPct = null;
  if(sex === 'male' && waist && neck){
    // male: % body fat = 86.010*log10(waist-neck) - 70.041*log10(height) + 36.76
    bodyFatPct = 86.010 * Math.log10(waist - neck) - 70.041 * Math.log10(heightCm) + 36.76;
  } else if(sex === 'female' && waist && neck && hip){
    // female: % body fat = 163.205*log10(waist+hip-neck) - 97.684*log10(height) - 78.387
    bodyFatPct = 163.205 * Math.log10(waist + hip - neck) - 97.684 * Math.log10(heightCm) - 78.387;
  } else {
    // fallback rough estimate using BMI
    // %bodyfat ~ (1.20 * BMI) + (0.23 * age) - (10.8 * sex) - 5.4; sex: male=1 female=0
    const sexNum = (sex === 'male') ? 1 : 0;
    bodyFatPct = (1.20 * bmi) + (0.23 * age) - (10.8 * sexNum) - 5.4;
  }
  bodyFatPct = Math.max(2, Math.min(60, bodyFatPct)); // clamp
  document.getElementById('bodyfat').innerText = bodyFatPct.toFixed(1) + " %";

  // --- Muscle proxy (heuristic)
  // Simple heuristic: lean mass = weight*(1 - bodyFatPct/100)
  const leanMass = weightKg * (1 - bodyFatPct/100);
  // muscle proxy (not accurate but gives relative number): leanMass * (height ratio)
  const muscleProxy = leanMass * (heightCm / 180);
  document.getElementById('muscle').innerText = muscleProxy.toFixed(1) + " kg proxy";

  // Build payload for server/AI
  const payload = {
    sex, age, heightCm, weightKg, waist, neck, hip, activity,
    computed: { bmi: +bmi.toFixed(1), bodyFatPct: +bodyFatPct.toFixed(1), muscleProxy: +muscleProxy.toFixed(1) }
  };

  // Update UI
  const statusEl = document.getElementById('aiStatus');
  const aiOutput = document.getElementById('aiOutput');
  statusEl.innerText = 'Envoi des données au serveur pour analyse IA…';
  aiOutput.innerText = 'Génération en cours…';

  // Call backend API that will call the LLM securely.
  // You must implement /api/analyze on your server.
  // Example server payload: POST /api/analyze { payload }
  fetch('/api/analyze', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(r => {
    if(!r.ok) throw new Error('Server error: ' + r.status);
    return r.json();
  })
  .then(data => {
    // Expecting { analysis: "..." }
    statusEl.innerText = 'Analyse IA reçue';
    aiOutput.innerText = data.analysis || JSON.stringify(data, null, 2);
  })
  .catch(err => {
    statusEl.innerText = 'Erreur lors de l’appel serveur. Voir console.';
    aiOutput.innerText = 'Impossible d’obtenir l’analyse IA — le serveur local n’est pas configuré.\n\n' +
      'Pour activer l’IA, implémentez une route POST /api/analyze qui appelle l’API de votre modèle et renvoie JSON { analysis }.\n\n' +
      'Erreur: ' + err.message;
    console.error(err);
  });
}
</script>
</body>
</html>